<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 tidyverse | 2022년 한국생명공학연구원 연구데이터 분석과정 R</title>
<meta name="author" content="합성생물학전문연구소 김하성">
<meta name="description" content="tidyverse (https://www.tidyverse.org/)는 데이터 사이언스를 위한 R 기반의 독창적인 패키지들의 모음입니다. Rstudio의 핵심 전문가인 해들리위컴이 (Hadley Wickham) 중심이 되어 만들어 졌으며 기존의 툴보다 쉽고 효율적으로 데이터 분석을 수행할 수 있습니다. 데이터사이언스는 넓은 범위의 개념과 방법적인...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 8 tidyverse | 2022년 한국생명공학연구원 연구데이터 분석과정 R">
<meta property="og:type" content="book">
<meta property="og:description" content="tidyverse (https://www.tidyverse.org/)는 데이터 사이언스를 위한 R 기반의 독창적인 패키지들의 모음입니다. Rstudio의 핵심 전문가인 해들리위컴이 (Hadley Wickham) 중심이 되어 만들어 졌으며 기존의 툴보다 쉽고 효율적으로 데이터 분석을 수행할 수 있습니다. 데이터사이언스는 넓은 범위의 개념과 방법적인...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 tidyverse | 2022년 한국생명공학연구원 연구데이터 분석과정 R">
<meta name="twitter:description" content="tidyverse (https://www.tidyverse.org/)는 데이터 사이언스를 위한 R 기반의 독창적인 패키지들의 모음입니다. Rstudio의 핵심 전문가인 해들리위컴이 (Hadley Wickham) 중심이 되어 만들어 졌으며 기존의 툴보다 쉽고 효율적으로 데이터 분석을 수행할 수 있습니다. 데이터사이언스는 넓은 범위의 개념과 방법적인...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">2022년 한국생명공학연구원 연구데이터 분석과정 R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="rrstudio-basics.html"><span class="header-section-number">2</span> R/Rstudio basics</a></li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">3</span> Rmarkdown</a></li>
<li><a class="" href="r-programming.html"><span class="header-section-number">4</span> R programming</a></li>
<li><a class="" href="data-transformation.html"><span class="header-section-number">5</span> Data transformation</a></li>
<li><a class="" href="lecture-2-note.html"><span class="header-section-number">6</span> Lecture 2 Note</a></li>
<li><a class="" href="r-basic-graphics.html"><span class="header-section-number">7</span> R basic graphics</a></li>
<li><a class="active" href="tidyverse.html"><span class="header-section-number">8</span> tidyverse</a></li>
<li><a class="" href="lecture-3-note.html"><span class="header-section-number">9</span> Lecture 3 Note</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidyverse" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> tidyverse<a class="anchor" aria-label="anchor" href="#tidyverse"><i class="fas fa-link"></i></a>
</h1>
<p>tidyverse (<a href="https://www.tidyverse.org/)%EB%8A%94" class="uri">https://www.tidyverse.org/)는</a> 데이터 사이언스를 위한 R 기반의 독창적인 패키지들의 모음입니다. Rstudio의 핵심 전문가인 해들리위컴이 (Hadley Wickham) 중심이 되어 만들어 졌으며 기존의 툴보다 쉽고 효율적으로 데이터 분석을 수행할 수 있습니다.</p>
<div class="inline-figure"><img src="images/07/tidyverse.JPG" width="550"></div>
<p>데이터사이언스는 넓은 범위의 개념과 방법적인 정도가 있는 것은 아닙니다. 그러나 tidyverse의 목적은 데이터 분석을 위한 핵심이되는 고효율의 툴을 제공하는 것이며 그 철학은 다음과 같은 그림으로 요약할 수 있습니다.</p>
<div class="figure">
<img src="images/07/data-science.png" alt=""><p class="caption">from <a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a></p>
</div>
<div id="tibble-object-type" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> tibble object type<a class="anchor" aria-label="anchor" href="#tibble-object-type"><i class="fas fa-link"></i></a>
</h2>
<p>R은 20년 이상된 비교적 오랜 역사를 가진 언어로서 <code>data.frame</code> 형태의 데이터 타입이 가장 많이 사용되고 있습니다. 그러나 당시에는 유용했던 기능이 시간이 흐르면서 몇몇 단점들이 드러나는 문제로 기존 코드를 그대로 유지한채 package 형태로 단점을 보완한 새로운 형태의 tibble 오브젝트 형식을 만들어 냈습니다. 대부분의 R 코드는 여전히 data.frame 형태의 데이터 타입을 사용하고 있으나 tidyverse에서는 <code>tibble</code>이 사용되는 것을 참고하시기 바랍니다.</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, 
  y <span class="op">=</span> <span class="fl">1</span>, 
  z <span class="op">=</span> <span class="va">x</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">+</span> <span class="va">y</span>
<span class="op">)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></code></pre></div>
<p><code>tibble</code>은 <code>data.frame</code>과 다음 몇 가지 점이 다릅니다. <code>data.frame</code>의 경우 타입을 변환할 때 강제로 값의 타입을 바꾸거나 내부 변수의 이름을 바꾸는 경우가 있었으나 <code>tibble</code>은 이를 허용하지 않습니다. 샘플들 (row) 이름을 바꿀수도 없습니다. 또한 프린팅할 때 출력물에 나오는 정보가 다르며 마지막으로 <code>data.frame</code>은 subset에 대한 타입이 바뀔 경우가 있었지만 <code>tibble</code>은 바뀌지 않습니다.</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></code></pre></div>
<p><code>tibble</code>은 컬럼 하나가 벡터형 변수가 아닌 리스트형 변수가 될 수 있다는 것도 <code>data.frame</code>과 다른 점 입니다.</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>`crazy name` <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>`crazy name` <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>또한 다음과 같이 사용되는 변수의 (<code>x</code>) 참조 범위가 다릅니다.</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, y <span class="op">=</span> <span class="va">x</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, y <span class="op">=</span> <span class="va">x</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, y <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>

<span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, y <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df2</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df2</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></code></pre></div>
</div>
<div id="tidy-data-structure" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Tidy data structure<a class="anchor" aria-label="anchor" href="#tidy-data-structure"><i class="fas fa-link"></i></a>
</h2>
<p>데이터의 변수와 값을 구분하는 일은 적절한 데이터 분석을 위해 필수적인 과정입니다. 특히 복잡하고 사이즈가 큰 데이터일 경우는 더욱 중요할 수 있으나 경험에 의존해서 구분을 하는 것이 대부분 입니다. Tidy data는 이러한 변수와 값의 명확한 구분과 활용을 위한 데이터 구조중 하나 입니다 (Hadley Wickham. Tidy data. <em>The Journal of Statistical Software</em>, vol. 59, 2014).</p>
<div class="inline-figure"><img src="images/07/notidy.JPG"></div>
<p>tidy data는 다음과 같은 특징이 있습니다.</p>
<ul>
<li>각 변수는 해당하는 유일한 하나의 column을 가짐</li>
<li>각 샘플은 해당하는 유일한 하나의 row를 가짐</li>
<li>각 관측값은 해당하는 유일한 하나의 cell을 가짐</li>
</ul>
<div class="figure">
<img src="images/07/tidy-1.png" width="600" alt=""><p class="caption">from <a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a></p>
</div>
<p>Tidy 데이터는 Long형 데이터로 알려져 있기도 합니다. 참고로 Wide형 데이터의 경우 샘플 데이터가 늘어날수록 row에 쌓이고 새로운 변수는 column에 쌓이는 방식으로 데이터가 확장되는 형태 입니다. 엑셀에서 볼 수 있는 일반적인 형식으로 다음 그림과 같습니다.</p>
<div class="inline-figure"><img src="images/07/05.png"></div>
<p>Long형 데이터의 경우 ID, variable, value 세가지 변수만 기억하면 되겠습니다. 위 wide형 데이터 경우를 보면 ID, variable, 그리고 value 이 세가지 요인이 주요 구성 요소임을 알 수 있습니다. Long형으로 변환할 경우 샘플을 참조할 수 있는 어떤 변수 (variable)도 ID가 될 수 있으며 2개 이상의 변수가 ID로 지정될 수 있습니다. 참고로 ID를 지정할 경우 해당 ID는 가능하면 중복되지 않는 값들을 갖는 변수를 사용해야 식별자로서 기능을 적절히 수행할 수 있습니다. Long형을 사용할 경우 데이터의 변수가 늘어나도 행의 수만 늘어나므로 코딩의 일관성과 변수들의 그룹을 만들어서 분석하는 등의 장점이 있습니다. 아래는 새로운 변수 F가 추가될 때 long 형 데이터에 데이터가 추가되는 경우를 나타낸 그림 입니다.</p>
<div class="inline-figure"><img src="images/07/06.png"></div>
</div>
<div id="pipe-operator" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Pipe operator<a class="anchor" aria-label="anchor" href="#pipe-operator"><i class="fas fa-link"></i></a>
</h2>
<p>tidyverse 패키지를 활용하기 위해서는 <code>%&gt;%</code> 파이프 오퍼레이터의 이해가 필요합니다. 파이프 오퍼레이터의 작동법은 간단히 <code>%&gt;%</code>의 왼쪽 코드의 결과를 출력으로 받아 오른쪽 코드의 입력 (첫번째 파라미터의 값)으로 받아들이는 작동을 합니다 (<strong>단축키: Shift+Ctrl+m</strong>). 다음 예에서 보면 <code>sin(pi)</code> 와 같은 함수의 일반적인 사용법 대신 <code>pi %&gt;% sin</code> 처럼 사용해도 똑같은 결과를 보여줍니다. <code>cos(sin(pi))</code>와 같이 여러 합수를 중첩하여 사용할 경우와 비교해서 코드의 가독성이나 효율 측면에서 크게 향상된 방법을 제공해 줍니다.</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">pi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">sin</span>
<span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span>
<span class="va">pi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">sin</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">cos</span>
<span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>특히 <code>%&gt;%</code>는 이후 설명할 <code>dplyr</code>의 <code>group_by</code>, <code>split</code>, <code>filter</code>, <code>summary</code> 등 행렬 편집/연산 함수를 빈번히 다양한 조합으로 쓰게되는 상황에서 더 큰 효과를 발휘할 수 있습니다.</p>
<div class="inline-figure"><img src="images/07/02.PNG" width="500"></div>
<p>pipe operator의 왼쪽 구문의 결과가 오른쪽 구문의 첫 번째 파라미터의 입력 값으로 처리된다고 말씀 드렸습니다. 즉, 함수에서 사용되는 파라미터가 여러개일 경우가 있으므로 기본적으로 <code>%&gt;%</code> 의 왼쪽 구문의 출력 값은 오른쪽 구문 (함수)의 첫 번째 인자의 입력값으로 들어가는 것 입니다. 이는 다음 예들을 통해서 명확히 알 수 있습니다. 먼저 <code>paste</code>함수는 그 파라미터로 <code>,</code>로 구분되는 여러개의 입력 값을 가질 수 있습니다. 따라서 다음 코드는 <code>x</code>가 <code>paste</code>의 첫 번째 파라미터로 들어가게 되어 <code>"1a", "2a", "3a", "4a", "5a"</code>로 a 앞에 x 값들이 붙어서 출력된 것을 알 수 있습니다.</p>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>
<span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"a"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></code></pre></div>
<p>특정 데이터셋의 컬럼별 평균을 구하고 각 평균의 합을 구할 경우를 생각해 봅시다. R에서는 <code>colMeans</code>라는 특별한 함수를 제공하여 컬럼별로 평균을 계산해 줍니다. 그 후 sum 함수를 사용하여 최종 원하는 값을 얻을 수 있습니다. 이러한 코드를 <code>%&gt;%</code> 오퍼레이터를 사용한 경우의 코드와 비교해 볼 수 있습니다.</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">colMeans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">sum</span></code></pre></div>
<p>그럼 만약 두 번째 파라미터에 입력으로 왼쪽 구문의 출력을 받아들이고 싶을 경우는 place holer <code>.</code> 을 사용하면 되겠습니다. <code>round</code> 함수는 두 개의 파라미터를 설정할 있 이으며 digits 라는 두 번째 파라미터에 값을 pipe operator로 넘겨주고 싶을 경우 아래와 같이 표현할 수 있습니다.</p>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">6</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">pi</span>, digits<span class="op">=</span><span class="va">.</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">pi</span>, digits<span class="op">=</span><span class="fl">6</span><span class="op">)</span></code></pre></div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<ol style="list-style-type: decimal">
<li>pipe operator를 사용해서 <code>airquality</code>데이터를 long형으로 전환하는 코드를 작성하시오 (단 col 파라메터에는 Ozone, Solar.R, Wind, Temp 변수를 넣음)<br>
</li>
<li>pipe operator를 사용해서 <code>airquality</code>데이터의 Month와 Day 변수(컬럼)을 Date 변수로 병합하는 코드를 작성하시오</li>
</ol>
</div>
</div>
<div id="pivoting" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Pivoting<a class="anchor" aria-label="anchor" href="#pivoting"><i class="fas fa-link"></i></a>
</h2>
<p>일반적으로 얻어지는 데이터의 형태는 wide형이며 이를 Long형으로 변환하기 위해서는 <code>tidyverse</code> 패키지에 속한 <code>tidyr</code> 패키지의 <code>pivot_longer</code>와 <code>pivot_wider</code>를 사용합니다. 또한 <code>reshape2</code> 패키지의 <code>melt</code>함수와 그 반대의 경우 <code>dcast</code> 함수를 사용할 수도 있습니다. 본 강의에서는 <code>tidyr</code> 패키지를 사용합니다. wide형 데이터를 long형으로 변환하거나 long형을 wide형으로 변환하는 작업을 pivoting 이라고 합니다.</p>
<div class="inline-figure"><img src="images/07/wide2long.JPG"></div>
<p><code>airquality</code> 데이터는 전형적인 wide형 데이터로 특정 날짜에 네 개의 변수에 해당하는 값들을 측정했습니다. 이 데이터를 long형으로 바꿀 경우 ID를 날짜로 하면 데이터들을 식별 할 수 있습니다. 그런데 날짜는 변수가 Month와 Day두 개로 나누어져 있으므로 다음과 같이 두 변수를 식별 변수로 (ID로) 사용 합니다. 확인을 위해 상위 5개의 데이터만 가지고 형 변환을 진행해 보겠습니다.</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airquality</span>

<span class="va">myair</span> <span class="op">&lt;-</span> <span class="va">airquality</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span>
<span class="va">myair_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">myair</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ozone"</span>, <span class="st">"Solar.R"</span>, <span class="st">"Wind"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">)</span>
<span class="va">myair_long</span> 

<span class="va">myair_long</span> <span class="op">&lt;-</span> <span class="va">myair</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ozone"</span>, <span class="st">"Solar.R"</span>, <span class="st">"Wind"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">)</span>
<span class="va">myair_long</span> 

<span class="va">myair_long2</span> <span class="op">&lt;-</span> <span class="va">myair</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Ozone</span>, <span class="va">Solar.R</span>, <span class="va">Wind</span>, <span class="va">Temp</span><span class="op">)</span><span class="op">)</span>
<span class="va">myair_long2</span> 

<span class="va">myair_long3</span> <span class="op">&lt;-</span> <span class="va">myair</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Month</span>, <span class="va">Day</span><span class="op">)</span><span class="op">)</span>
<span class="va">myair_long3</span></code></pre></div>
<p>생성되는 long형 데이터의 변수 이름인 name과 value는 다음 파라메터를 지정하여 바꿀 수 있습니다.</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">myair_long</span> <span class="op">&lt;-</span> <span class="va">myair</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Ozone</span>, <span class="va">Solar.R</span>, <span class="va">Wind</span>, <span class="va">Temp</span><span class="op">)</span>, 
               names_to <span class="op">=</span> <span class="st">"Type"</span>, 
               values_to <span class="op">=</span> <span class="st">"Observation"</span><span class="op">)</span>
<span class="va">myair_long</span> </code></pre></div>
<p>long형 데이터를 wide형 데이터로 변환 할 수도 있습니다.</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myair_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>
    names_from <span class="op">=</span> <span class="va">Type</span>, 
    values_from <span class="op">=</span> <span class="va">Observation</span><span class="op">)</span></code></pre></div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<ol style="list-style-type: decimal">
<li>다음 데이터가 long형인지 wide형인지 판단하시오<br>
</li>
<li>long형이면 wide형으로 wide형이면 long형으로 변환하시오</li>
</ol>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  year   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2015</span>, <span class="fl">2016</span>, <span class="fl">2016</span><span class="op">)</span>,
  month  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>   <span class="fl">1</span>,    <span class="fl">2</span>,     <span class="fl">1</span>,    <span class="fl">2</span><span class="op">)</span>,
  profit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<p>앞서 gse93819 데이터에서 만든 myexpmean data.frame을 long 형으로 변환하시오</p>
</div>
<p><code>ggplot</code>을 이용한 그래프 작성에는 위와 같은 long형 데이터가 주로 사용됩니다. R을 이용한 데이터 가시화는 <code>dplyr</code> 패키지로 wide형 데이터를 편집하고 <code>pivot_longer</code> 함수로 long형 데이터로 변환 후 <code>ggplot</code>을 이용하는 방식으로 수행합니다. 두 데이터 포멧에 대한 좀 더 구체적인 내용은 다음 링크를 참고하시기 바랍니다. <a href="https://www.theanalysisfactor.com/wide-and-long-data/" class="uri">https://www.theanalysisfactor.com/wide-and-long-data/</a></p>
</div>
<div id="separating-and-uniting" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Separating and uniting<a class="anchor" aria-label="anchor" href="#separating-and-uniting"><i class="fas fa-link"></i></a>
</h2>
<p>데이터를 분석할 때 하나의 컬럼에 두 개 이상의 변수값이 저장되어 있거나 두 개의 변수를 하나의 컬럼으로 합해야 하는 경우가 종종 있습니다. 전자의 경우 <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> 함수를 사용해서 두 변수(컬럼)으로 나누어 줄 수 있으며 후자의 경우 <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> 함수를 사용하여 두 변수를 하나의 값으로 병합할 수 있습니다. 다음은 <code>airquality</code>데이터에서 Month와 Day 변수를 하나의 컬럼으로 병합하여 Date라는 변수로 만들어 주는 경우의 예 입니다.</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">newairquality</span> <span class="op">&lt;-</span> <span class="va">airquality</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Month</span>, <span class="va">Day</span>, sep<span class="op">=</span><span class="st">"."</span><span class="op">)</span>
<span class="va">newairquality</span></code></pre></div>
<p><code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>함수를 사용하면 다음과 같이 해당 변수의 값을 나누어 다시 두 개의 변수(컬럼)으로 나누어 줄 수 있습니다.</p>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newairquality</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col<span class="op">=</span><span class="va">Date</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Month"</span>, <span class="st">"Day"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span></code></pre></div>
</div>
<div id="dplyr" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> dplyr<a class="anchor" aria-label="anchor" href="#dplyr"><i class="fas fa-link"></i></a>
</h2>
<p><code>dplyr</code> (<a href="https://dplyr.tidyverse.org/" class="uri">https://dplyr.tidyverse.org/</a>) 은 <code>ggplot2</code>을 개발한 해들리위컴이 (Hadley Wickham) 중심이 되어 만들어 졌으며 ggplot2와 함께 tidyverse의 (<a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a>) 핵심 패키지 입니다. <code>dplyr</code>은 데이터를 다루는 크기나 분석의 속도, 편의성을 향상시켜 새롭게 만들어놓은 패키지 입니다. 기존 <code>apply</code>와 같은 행렬 연산 기능과 <code>subset</code>, <code>split</code>, <code>group</code> 와 같은 행렬 편집 기능을 더하여 만들어진 도구라고 할 수 있습니다.</p>
<p><code>dplyr</code>의 전신이라 할 수 있는 <code>plyr</code> 패키지는 다음과 같이 설명이 되어 있습니다. A set of tools for a common set of problems: you need to split up a big data structure into homogeneous pieces, apply a function to each piece and then combine all the results back together. 즉 split-apply-combine 세 가지 동작을 쉽게 할 수 있도록 만들어 놓은 툴 입니다. R이 다른 언어에 비해 데이터 분석에서 주목을 받는 이유로 <code>split</code>, <code>apply</code> 등의 행렬 연산 함수가 발달한 것을 내세우는데 <code>dplyr</code>은 이들을 보다 더 편리하게 사용할 수 있도록 만들어 놓은 것 입니다.</p>
<p>이제 <code>dplyr</code> 패키지에서 제공하는 함수를 사용해 보겠습니다. <code>dplyr</code>을 구성하는 중요한 함수는 다음과 같습니다.</p>
<ul>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> - 변수 (columns) 선택</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> - 샘플 (rows) 선택</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> - 샘플들의 정렬 순서 변경</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> - 새로운 변수 만들기</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> - 대표값 만들기</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> - 그룹별로 계산 수행</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join()</a></code> - 두 tibble 또는 data.frame을 병합할 때 사용</p></li>
<li>
<p>위 함수들과 (특히 <code>filter</code>, <code>select</code>, <code>mutate</code>, <code>summarise</code>) 조합하여 (함수 내에서) 사용할 수 있는 helper 함수들이 같이 사용될 수 있습니다 (독립적으로도 사용 가능).</p>
<ul>
<li><code>across</code></li>
<li><code>if_any</code></li>
<li><code>if_all</code></li>
<li><code>everything</code></li>
<li><code>starts_with</code></li>
<li><code>end_with</code></li>
<li><code>contains</code></li>
</ul>
</li>
</ul>
<p>이 함수들은 <code>%&gt;%</code>와 함께 쓰이면서 강력한 성능을 발휘합니다. <code>summarise</code> 함수는 특정 값들의 통계 값을 계산해 주는 함수이며 그 외 함수들은 행렬 편집을 위한 함수들로 보시면 되겠습니다. 간단한 예제를 수행하면서 각각의 기능을 살펴보고 왜 <code>dplyr</code>이 널리 사용되고 그 장점이 무엇인지 파악해 보도록 하겠습니다.</p>
<p><code>iris</code> 데이터는 세 종류의 iris 품종에 대한 꽃잎과 꽃받침의 length와 with를 측정해 놓은 데이터 입니다. <code>head</code>와 <code>str</code> 명령어를 <code>%&gt;%</code>를 이용해서 데이터를 살펴 봅니다.</p>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">str</span></code></pre></div>
<div id="select" class="section level3" number="8.6.1">
<h3>
<span class="header-section-number">8.6.1</span> select<a class="anchor" aria-label="anchor" href="#select"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> 는 주어진 데이터셋으로부터 관심있는 변수를 (column) 선택하여 보여줍니다.</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>
<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Species</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Species</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span></code></pre></div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<p>babies 데이터의 변수/구조를 확인해 보고 id, age, gestation, wt, dwt, smoke 변수만을 선택한 새로운 newbabies 데이터를 만드시오</p>
</div>
<p>다음 helper 함수들은 <code>select</code> 함수와 같이 유용하게 쓰일 수 있습니다.</p>
<blockquote>
<p>starts_with(“abc”) - “abc” 로 시작하는 문자열을 갖는 변수 이름
ends_with(“xyz”) - “xyz”으로 끝나는 문자열을 갖는 변수 이름
contains(“ijk”) - “ijk” 문자열을 포함하는 변수 이름
matches(“(.)\1”) - 정규식, 반복되는 문자</p>
</blockquote>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">'S'</span><span class="op">)</span><span class="op">)</span>
<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">'S'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>아래는 <code>matches</code> 함수를 사용한 방법 입니다. 좀 더 복잡한 패턴을 적용하여 변수들을 선택할 수 있으며 <code>grep</code> 함수를 사용할 경우도 정규식 패턴을 적용할 수 있습니다.</p>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">iris</span>, aavar <span class="op">=</span> <span class="va">Petal.Length</span><span class="op">)</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">iris2</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"(.)\\1"</span><span class="op">)</span><span class="op">)</span>
<span class="va">tmp</span> <span class="op">&lt;-</span><span class="va">iris</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"^S"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="va">iris</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"^S"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="va">tmp</span></code></pre></div>
<p>아래 <code>(.)\\1</code>은 하나의 문자 <code>.</code>가 (어떤 문자든) 한 번 더 <code>\\1</code> 사용된 변수 이름을 말하며 이는 <code>aavar</code> 의 <code>aa</code>밖에 없으므로 <code>aavar</code>가 선택됩니다. <code>grep</code>에서 <code>^</code> 표시는 맨 처음을 나타내므로 <code>^S</code>는 S로 시작하는 문자가 되겠습니다. 따라서 <code>grep("^S", colnames(iris))</code>의 경우 컬럼 이름 중 S로 시작하는 이름은 True로 그렇지 않으면 False 값을 리턴합니다.</p>
</div>
<div id="filter" class="section level3" number="8.6.2">
<h3>
<span class="header-section-number">8.6.2</span> filter<a class="anchor" aria-label="anchor" href="#filter"><i class="fas fa-link"></i></a>
</h3>
<p><code>filter</code> 함수를 사용해서 원하는 조건의 데이터 (샘플)을 골라낼 수 있습니다.</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>
<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span><span class="op">==</span><span class="st">"setosa"</span><span class="op">)</span>

<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span><span class="op">==</span><span class="st">"setosa"</span> <span class="op">|</span> <span class="va">Species</span><span class="op">==</span><span class="st">"versicolor"</span><span class="op">)</span>

<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span><span class="op">==</span><span class="st">"setosa"</span> <span class="op">&amp;</span> <span class="va">Species</span><span class="op">==</span><span class="st">"versicolor"</span><span class="op">)</span>

<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span><span class="op">==</span><span class="st">"setosa"</span> <span class="op">|</span> <span class="va">Species</span><span class="op">==</span><span class="st">"versicolor"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="va">dim</span></code></pre></div>
<p><code>filter</code>의 <code>,</code>로 구분되는 매개변수는 <code>and</code> 로직으로 묶인 조건입니다. 지난 강좌에서 보셨듯 R에서 <code>and</code>는 <code>&amp;</code>, <code>or</code>는 <code>|</code>, 그리고 not은 <code>!</code> 으로 사용하면 되며 <code>filter</code>에서 <code>,</code>로 구분된 조건은 <code>and</code>와 같다고 보시면 되겠습니다.</p>
<div class="inline-figure"><img src="images/07/03.png" width="500"></div>
<p>Image from (<a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a>)</p>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<p>위 예제에서 만든 newbabies 데이터에서 999 값이 들어있는 값을 제외한 새로운 데이터를 만드시오</p>
</div>
</div>
<div id="arrange" class="section level3" number="8.6.3">
<h3>
<span class="header-section-number">8.6.3</span> arrange<a class="anchor" aria-label="anchor" href="#arrange"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>는 지정된 변수를 기준으로 값의 크기순서로 샘플들의 배열 순서 즉, row의 순서를 바꾸는 기능을 수행합니다. 기본으로 크기가 커지는 순서로 정렬이 진행되며 작아지는 순서를 원할 경우 <code>desc</code> 함수를 사용할 수 있습니다.</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span>
<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span>
<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Sepal.Width</span><span class="op">)</span></code></pre></div>
</div>
<div id="mutate" class="section level3" number="8.6.4">
<h3>
<span class="header-section-number">8.6.4</span> mutate<a class="anchor" aria-label="anchor" href="#mutate"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> 함수는 새로운 변수를 추가할 수 있는 기능을 제공하며 앞에서 배웠던 <code><a href="https://rdrr.io/r/base/with.html">within()</a></code>과 비슷하다고 볼 수 있습니다. 아래와 같이 <code>mutate</code>함수는 sepal_ratio라는 변수를 새로 만들어서 기존 iris 데이터들과 함께 반환해 줍니다.</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris2</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sepal_ratio <span class="op">=</span> <span class="va">Sepal.Length</span><span class="op">/</span><span class="va">Sepal.Width</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris2</span><span class="op">)</span></code></pre></div>
</div>
<div id="summarise" class="section level3" number="8.6.5">
<h3>
<span class="header-section-number">8.6.5</span> summarise<a class="anchor" aria-label="anchor" href="#summarise"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>는 <code>data.frame</code>내 특정 변수의 값들로 하나의 요약값/대푯값을 만들어 줍니다. <code>summarise</code> 함수는 단독으로 쓰이기 보다는 <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> 기능과 병행해서 쓰이는 경우에 유용하게 쓰입니다. <code><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all()</a></code> 함수를 사용하면 모든 변수에 대해서 지정된 함수를 실행합니다. 특히 summarise 함수는 다음과 같이 <code>across</code>, <code>if_any</code>, <code>if_all</code> 등의 helper 함수와 조합되어 사용이 가능합니다.</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span>, m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span>
<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span>

<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span>

<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span>


<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="va">sd</span><span class="op">)</span>

<span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">sd</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="join" class="section level3" number="8.6.6">
<h3>
<span class="header-section-number">8.6.6</span> join<a class="anchor" aria-label="anchor" href="#join"><i class="fas fa-link"></i></a>
</h3>
<p><code>join</code> 함수는 데이터를 병합해주는 기능을 수행하는 함수 입니다. 네 가지 종류의 함수가 있으며 (<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>, ’right_join()<code>, 'inner_join()</code>, ’full_join()<code>) 기본적으로 공통되는 이름의 변수를 (key) 이용해서 공통되는 샘플끼리 자동으로 병합해 주는 기능을 수행합니다.</code>by`에서 지정해준 파라메터의 값을 기준으로 기능이 수행 됩니다.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span>, age<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">41</span>, <span class="fl">33</span>, <span class="fl">56</span>, <span class="fl">20</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span>
<span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span>, gender<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"f"</span>, <span class="st">"m"</span>, <span class="st">"m"</span>, <span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by<span class="op">=</span><span class="st">"id"</span><span class="op">)</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, <span class="st">"id"</span><span class="op">)</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, <span class="st">"id"</span><span class="op">)</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, <span class="st">"id"</span><span class="op">)</span>

<span class="co"># vs.</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="code-comparison" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Code comparison<a class="anchor" aria-label="anchor" href="#code-comparison"><i class="fas fa-link"></i></a>
</h2>
<p>이제 <code>split</code>, <code>apply</code>, <code>combine</code>을 활용하여 평균을 구하는 코드와 <code>dplyr</code> 패키지를 사용하여 만든 코드를 비교해 보도록 하겠습니다. iris 데이터를 분석하여 품종별로 꽃받침의 길이 (Sepal.length)의 평균과 표준편차, 그리고 샘플의 수를 구해보는 코드입니다.</p>
<p><code>split</code>은 <code>factor</code>형 변수인 Species를 기준으로 <code>iris</code> 데이터를 나누어 주는 역할을 하며 <code>lapply</code>는 <code>list</code> 형 데이터인 <code>iris_split</code>을 각 리스트의 각각의 원소들에 대해서 임의의 함수 <code>function(x)...</code> 를 수행하는 역할을 합니다. 마지막 <code>data.frame</code>으로 최종 경로를 combine 합니다.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">iris</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>
<span class="va">iris_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">iris_split</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="va">iris_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">iris_split</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="va">iris_cnt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">iris_split</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="va">iris_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">iris_cnt</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">iris_means</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">iris_sd</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>아래는 <code>dplyr</code> 패키지를 사용한 코드 입니다.</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_df</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>위에서 보듯 <code>dplyr</code> 패키지를 사용할 경우 그 결과는 같으나 코드의 가독성과 효율성면에서 장점을 보여줍니다. <code>iris</code> 데이터를 받아서 Species에 명시된 그룹으로 나누고 원하는 함수를 타깃 컬럼에 대해서 적용하라는 의미 입니다. 다음은 모든 변수에 대한 평균을 구하는 코드 입니다.</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_mean_df</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>자세한 ggplot의 내용은 다음시간에 학습하겠지만 각 평균에 대한 막대그래프를 그러보겠습니다.</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="va">iris_mean_df2</span> <span class="op">&lt;-</span> <span class="va">iris_mean_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">iris_mean_df2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Species</span>, y<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position<span class="op">=</span><span class="st">"dodge"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08/Rplot01.png" width="500"></div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<p>5.5의 babies 데이터를 tidyverse 패키지를 활용하여 다시 분석해 보시오 (모든 경우를 tidyverse 패키지 함수를 사용할 필요는 없음, <code>select</code> 를 사용할 경우 <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select</a></code> 로 사용하시오)</p>
<ol style="list-style-type: decimal">
<li><p>babies 데이터의 변수를 확인하시오</p></li>
<li><p>babies 데이터의 id, age, gestation, wt, dwt, smoke 변수만을 갖는 newbabies 데이터를 만드시오</p></li>
<li><p>위 2번에 더해 999로 입력된 데이터를 제외한 newbabies 데이터를 만드시오</p></li>
<li><p>위 3번에 더해 smoke 데이터를 factor 형으로 변환한 smokef 변수를 추가한 newbabies 데이터를 만드시오</p></li>
<li><p>위 4번에 더해 25세 미만의 샘플만 갖고 smoke 변수는 제외한 는 newbabies 데이터를 만드시오</p></li>
</ol>
</div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<ol style="list-style-type: decimal">
<li><p><code>airquality</code> 데이터에서 <code>NA</code>가 포함된 샘플 (row)를 제거한 <code>myair</code> 라는 데이터셋을 생성하시오</p></li>
<li><p>위 1)에 Month 변수를 factor형으로 변환한 Monthf 를 추가하고 Month와 Day 변수를 제거한 새로운 데이터셋 <code>myair</code> 데이터를 생성하시오</p></li>
<li><p>myair 데이터에서 월별로 모든 변수에 (Ozone, Solar.R, Wind, Temp) 대한 평균을 구한 후 <code>myairmean</code> 변수에 저장하시오 (group_by로 먼저 Monthf를 기준으로 grouping 필요, summarise_all 사용)</p></li>
<li><p>위 3)에 더하여 데이터를 long 형으로 바꾸고 myairmean에 저장하시오</p></li>
<li><p><code>ggplot</code>으로 myairmean 데이터의 월별 각 변수들의 평균 값들을 다음과 같은 bar 그래프로 그리시오</p></li>
</ol>
<pre><code>ggplot(myairmean, aes(x=Monthf, y=value, fill=Monthf)) +
  geom_bar(stat="identity") +
  theme_bw()</code></pre>
<div class="inline-figure"><img src="images/08/00002e.png"></div>
</div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<p>InsectSprays 데이터는 살충제 6종에 대한 살충력을 (죽은 벌래의 마릿수) 나타내는 데이터이다. 각 살충제별로 평균과 표준편차를 구하시오</p>
</div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<p>dplyr 패키지의 starwars 는 스타워즈 영화에 나오는 등장인물들을 분석한 데이터셋 이다. 종족에 따른 키의 평균과 표준편차를 구하시오. (NA 데이터는 제외하고 분석)</p>
</div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<p>airquality 데이터는 뉴욕주의 몇몇 지점에서의 공기질을 측정한 데이터이다. 데이터에서 NA를 제거하고 각 월별로 평균 오존, 자외선, 풍속, 및 온도에 대한 평균과 표준편차를 구하시오</p>
</div>
<p>참고로 errorbar가 있는 막대그래프를 그려보겠습니다. 이를 위해서 먼저 두 테이블을 병합한 후 <code>ggplot2</code> 패키지의 <code>ggplot</code> 함수를 이용해서 그래프를 그립니다. 자세한 <code>ggplot</code>의 내용은 다음시간에 학습하겠습니다.</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">airdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">airmean</span>, <span class="va">airsd</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Month"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">airdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Month</span>, y<span class="op">=</span><span class="va">mean</span>, fill<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position<span class="op">=</span><span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">mean</span><span class="op">-</span><span class="va">sd</span>, ymax<span class="op">=</span><span class="va">mean</span><span class="op">+</span><span class="va">sd</span><span class="op">)</span>, position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/08/Rplot02.png" width="500"></div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<ol style="list-style-type: decimal">
<li>다음 코드를 이용해서 gse93819 실험 관련 파일들을 다운로드하여 저장하고 데이터의 구조 및 샘플들의 이름을 확인하시오</li>
</ol>
<pre><code>myexp &lt;- read.csv("https://github.com/greendaygh/kribbr2022/raw/main/examples/gse93819_expression_values.csv", header=T)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>샘플들의 정보에 따라서 발현 데이터를 나누시오</p></li>
<li><p>각 그룹별 프루브들의 평균과 표준편차를 구하시오</p></li>
</ol>
</div>
<div class="rmdnote">
<p><strong>Exercises</strong></p>
<p>gse103512 데이터도 동일한 방법으로 분석해 보시오</p>
</div>
</div>
<div id="참고-통계" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> 참고 통계<a class="anchor" aria-label="anchor" href="#%EC%B0%B8%EA%B3%A0-%ED%86%B5%EA%B3%84"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://greendaygh.github.io/Rstat2020/statistical-inference.html#two-sample-significance-tests" class="uri">https://greendaygh.github.io/Rstat2020/statistical-inference.html#two-sample-significance-tests</a></li>
<li>정규분포와 t분포이해</li>
<li>t 통계량 계산</li>
<li>t-test 이해</li>
</ul>
<hr>
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png"></a><br>이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="r-basic-graphics.html"><span class="header-section-number">7</span> R basic graphics</a></div>
<div class="next"><a href="lecture-3-note.html"><span class="header-section-number">9</span> Lecture 3 Note</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidyverse"><span class="header-section-number">8</span> tidyverse</a></li>
<li><a class="nav-link" href="#tibble-object-type"><span class="header-section-number">8.1</span> tibble object type</a></li>
<li><a class="nav-link" href="#tidy-data-structure"><span class="header-section-number">8.2</span> Tidy data structure</a></li>
<li><a class="nav-link" href="#pipe-operator"><span class="header-section-number">8.3</span> Pipe operator</a></li>
<li><a class="nav-link" href="#pivoting"><span class="header-section-number">8.4</span> Pivoting</a></li>
<li><a class="nav-link" href="#separating-and-uniting"><span class="header-section-number">8.5</span> Separating and uniting</a></li>
<li>
<a class="nav-link" href="#dplyr"><span class="header-section-number">8.6</span> dplyr</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#select"><span class="header-section-number">8.6.1</span> select</a></li>
<li><a class="nav-link" href="#filter"><span class="header-section-number">8.6.2</span> filter</a></li>
<li><a class="nav-link" href="#arrange"><span class="header-section-number">8.6.3</span> arrange</a></li>
<li><a class="nav-link" href="#mutate"><span class="header-section-number">8.6.4</span> mutate</a></li>
<li><a class="nav-link" href="#summarise"><span class="header-section-number">8.6.5</span> summarise</a></li>
<li><a class="nav-link" href="#join"><span class="header-section-number">8.6.6</span> join</a></li>
</ul>
</li>
<li><a class="nav-link" href="#code-comparison"><span class="header-section-number">8.7</span> Code comparison</a></li>
<li><a class="nav-link" href="#%EC%B0%B8%EA%B3%A0-%ED%86%B5%EA%B3%84"><span class="header-section-number">8.8</span> 참고 통계</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>2022년 한국생명공학연구원 연구데이터 분석과정 R</strong>" was written by 합성생물학전문연구소 김하성. It was last built on 2022-06-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
